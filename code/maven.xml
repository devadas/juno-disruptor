<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="maven-deployment" default="maven:all:release-snapshot" basedir="."
         xmlns:artifact="antlib:org.apache.maven.artifact.ant"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="antlib:org.apache.maven.artifact.ant ">

    <import file="build.xml"/>

    <property file="build.properties"/>

    <property name="dir.deploy.lib" value="lib/release"/>

    <typedef resource="org/apache/maven/artifact/ant/antlib.xml"
             uri="antlib:org.apache.maven.artifact.ant"
             classpath="${dir.deploy.lib}/maven-ant-tasks-2.1.3.jar"/>

    <macrodef name="version-artifacts">
        <attribute name="artifact.version"/>
        <sequential>
            <property name="artifact.pom" value="${dir.dist}/pom.xml"/>
            <property name="artifact.jar" value="${dir.dist}/disruptor-@{artifact.version}.jar"/>
            <property name="artifact.javadoc.jar" value="${dir.dist}/disruptor-javadoc-@{artifact.version}.jar"/>
            <property name="artifact.sources.jar" value="${dir.dist}/disruptor-sources-@{artifact.version}.jar"/>

            <copy file="pom.template" tofile="${artifact.pom}" overwrite="true">
                <filterset>
                    <filter token="VERSION" value="@{artifact.version}"/>
                </filterset>
            </copy>

            <copy file="${dir.dist}/disruptor.jar" tofile="${artifact.jar}"/>
            <copy file="${dir.dist}/disruptor-api.jar" tofile="${artifact.javadoc.jar}"/>
            <copy file="${dir.dist}/disruptor-src.jar" tofile="${artifact.sources.jar}"/>
        </sequential>
    </macrodef>

    <macrodef name="release-artifacts">
        <attribute name="repository.id"/>
        <attribute name="repository.url"/>
        <sequential>
            <artifact:mvn>
                <arg value="org.apache.maven.plugins:maven-gpg-plugin:1.4:sign-and-deploy-file"/>
                <arg value="-Durl=@{repository.url}"/>
                <arg value="-DrepositoryId=@{repository.id}"/>
                <arg value="-DpomFile=${artifact.pom}"/>
                <arg value="-Dfile=${artifact.jar}"/>
                <arg value="-Dsources=${artifact.sources.jar}"/>
                <arg value="-Djavadoc=${artifact.javadoc.jar}"/>
                <arg value="-Pgpg"/>
            </artifact:mvn>
        </sequential>
    </macrodef>

    <target name="maven:release-staging">
    <version-artifacts artifact.version="${version}"/>
        <release-artifacts repository.id="staging-repo"
                           repository.url="http://localhost:8081/nexus/content/repositories/releases"/>
    </target>

    <target name="maven:all:release-staging" depends="all, maven:release-staging"/>

    <target name="maven:release-snapshot">
        <version-artifacts artifact.version="${version}-SNAPSHOT"/>
        <release-artifacts repository.id="snapshots-repo"
                           repository.url="http://localhost:8081/nexus/content/repositories/snapshots"/>
    </target>

    <target name="maven:all:release-snapshot" depends="all, maven:release-snapshot"/>

</project>
